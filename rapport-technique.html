<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nextmux — Rapport Technique</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,300;0,400;0,600;1,400&family=Source+Code+Pro:wght@400;500&family=Source+Sans+3:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1a1a;
    --paper: #fafaf8;
    --accent: #1d4ed8;
    --border: #e2e0db;
    --muted: #6b6863;
    --code-bg: #f4f4f0;
    --highlight: #dbeafe;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Source Serif 4', Georgia, serif;
    font-size: 17px;
    line-height: 1.8;
    background: var(--paper);
    color: var(--ink);
    max-width: 820px;
    margin: 0 auto;
    padding: 60px 40px 100px;
  }

  h1 { font-size: 2.4rem; line-height: 1.2; margin-bottom: 8px; }
  h2 { font-size: 1.5rem; margin: 52px 0 16px; padding-bottom: 8px; border-bottom: 2px solid var(--ink); }
  h3 { font-size: 1.1rem; margin: 28px 0 10px; color: var(--accent); }

  p { margin-bottom: 16px; text-align: justify; }

  .cover-meta { color: var(--muted); font-family: 'Source Sans 3', sans-serif; font-size: 0.9rem; margin-bottom: 48px; padding-bottom: 32px; border-bottom: 2px solid var(--ink); }
  .cover-meta strong { color: var(--ink); }

  .abstract {
    background: var(--highlight);
    border-left: 4px solid var(--accent);
    padding: 20px 24px;
    margin: 32px 0;
    font-style: italic;
    border-radius: 0 6px 6px 0;
    font-size: 0.95rem;
  }

  code {
    font-family: 'Source Code Pro', monospace;
    background: var(--code-bg);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.82em;
    color: #c7254e;
    border: 1px solid var(--border);
  }

  pre {
    font-family: 'Source Code Pro', monospace;
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 20px;
    overflow-x: auto;
    font-size: 0.82rem;
    line-height: 1.6;
    margin: 20px 0;
  }

  pre code { background: none; border: none; padding: 0; color: inherit; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-family: 'Source Sans 3', sans-serif;
    font-size: 0.9rem;
  }

  th {
    background: var(--ink);
    color: var(--paper);
    padding: 10px 14px;
    text-align: left;
  }

  td {
    padding: 9px 14px;
    border-bottom: 1px solid var(--border);
  }

  tr:nth-child(even) td { background: #f7f6f4; }

  .pill {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-family: 'Source Sans 3', sans-serif;
    font-weight: 600;
    background: var(--highlight);
    color: var(--accent);
    border: 1px solid #bfdbfe;
    margin: 2px;
  }

  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px 0;
  }

  .box {
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 18px;
    background: white;
  }

  .box h4 { font-family: 'Source Sans 3', sans-serif; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); margin-bottom: 10px; }

  .box ul { padding-left: 20px; font-family: 'Source Sans 3', sans-serif; font-size: 0.9rem; }
  .box li { margin-bottom: 4px; }

  .note {
    background: #fffbeb;
    border: 1px solid #fde68a;
    border-radius: 6px;
    padding: 14px 18px;
    font-family: 'Source Sans 3', sans-serif;
    font-size: 0.88rem;
    margin: 20px 0;
  }

  footer { margin-top: 80px; padding-top: 24px; border-top: 1px solid var(--border); font-family: 'Source Sans 3', sans-serif; font-size: 0.8rem; color: var(--muted); text-align: center; }

  @media print { body { padding: 20px; } h2 { page-break-before: always; } }
</style>
</head>

<body>

<h1>Rapport Technique<br>Nextmux Mini ERP</h1>

<div class="cover-meta">
  <strong>Projet :</strong> Mini ERP — Gestion de Projets & Finance &nbsp;|&nbsp;
  <strong>Entreprise :</strong> Nextmux PME &nbsp;|&nbsp;
  <strong>Stack :</strong> PHP 8 / MySQL 8 / HTML CSS JS &nbsp;|&nbsp;
  <strong>Version :</strong> 1.0
</div>

<div class="abstract">
  Ce rapport présente la conception et le développement d'un Mini ERP interne pour la PME Nextmux. L'application permet la gestion centralisée des clients, projets, tâches, factures, paiements et dépenses, avec un tableau de bord financier synthétique.
</div>

<h2>1. Présentation du besoin</h2>

<p>Nextmux est une PME proposant des prestations de service numériques (développement web, design, conseil). L'absence d'outil de gestion unifié engendre des inefficacités : suivi de projets fragmenté entre e-mails et tableurs, facturation manuelle et chronophage, absence de visibilité financière consolidée.</p>

<p>L'objectif est de concevoir et développer un Mini ERP web interne couvrant :</p>

<div class="grid">
  <div class="box">
    <h4>Module Opérationnel</h4>
    <ul>
      <li>Gestion des clients (CRUD complet)</li>
      <li>Gestion des projets avec budget et statut</li>
      <li>Suivi des tâches avec priorité et deadline</li>
      <li>Calcul automatique du taux d'avancement</li>
    </ul>
  </div>
  <div class="box">
    <h4>Module Finance</h4>
    <ul>
      <li>Création et gestion de factures (HT / TVA / TTC)</li>
      <li>Enregistrement des paiements avec mode</li>
      <li>Gestion des dépenses par catégorie</li>
      <li>Tableau de bord financier avec KPIs</li>
    </ul>
  </div>
</div>

<h2>2. Choix techniques</h2>

<h3>Backend — PHP 8 + PDO</h3>
<p>PHP a été choisi pour sa simplicité de déploiement (LAMP/WAMP), sa maturité pour les applications de gestion et l'absence de configuration complexe. L'accès à la base de données est centralisé via PDO avec des requêtes préparées pour prévenir les injections SQL. La connexion est encapsulée dans une fonction singleton (<code>getDB()</code>) pour éviter les connexions multiples.</p>

<h3>Base de données — MySQL 8</h3>
<p>MySQL offre une excellente intégration avec PHP, une bonne gestion des transactions et des vues SQL pour centraliser les calculs financiers. Le moteur InnoDB est utilisé pour bénéficier des contraintes de clés étrangères avec cascade.</p>

<h3>Frontend — HTML / CSS / JavaScript natifs</h3>
<p>Aucun framework JavaScript n'a été utilisé, conformément aux contraintes du projet. Le design system est construit sur des variables CSS custom. L'interface adopte un thème sombre professionnel (dark mode) inspiré des outils de développement modernes, avec une typographie lisible et une hiérarchie visuelle claire.</p>

<h2>3. Architecture de l'application</h2>

<h3>Structure des fichiers</h3>

<pre><code>nextmux-erp/
├── index.php           # Tableau de bord principal
├── clients.php         # CRUD clients
├── projets.php         # CRUD projets + vue détail
├── taches.php          # CRUD tâches + filtres + statut rapide
├── factures.php        # CRUD factures + détail paiements
├── paiements.php       # Enregistrement paiements + historique
├── depenses.php        # CRUD dépenses + stats catégories
├── finance.php         # Tableau de bord financier
├── includes/
│   ├── db.php          # Connexion PDO + helpers (h, money, redirect…)
│   ├── header.php      # Layout HTML + sidebar + CSS global
│   └── footer.php      # Fermeture HTML
└── database.sql        # Schéma + vues + jeu de données test</code></pre>

<h3>Pattern architectural</h3>
<p>L'application suit un pattern MVC allégé sans framework. Chaque fichier PHP joue le rôle de contrôleur en traitant les actions (<code>list</code>, <code>create</code>, <code>edit</code>, <code>view</code>, <code>delete</code>) passées en paramètre GET. Le rendu HTML est réalisé via des inclusions PHP simples (<code>header.php</code>, <code>footer.php</code>).</p>

<h3>Gestion des actions</h3>

<pre><code>$action = $_GET['action'] ?? 'list';

// Pattern répété dans chaque module :
// 1. Traitement DELETE (GET)
if ($action === 'delete' && $id) { ... redirect(); }

// 2. Traitement formulaire (POST)
if ($_SERVER['REQUEST_METHOD'] === 'POST') { ... redirect(); }

// 3. Chargement données
$data = $db->prepare("...")->fetchAll();

// 4. Rendu (include header + HTML + include footer)</code></pre>

<h3>Vues SQL pour les calculs financiers</h3>
<p>Deux vues SQL centralisent les calculs complexes pour éviter leur répétition dans le code PHP :</p>

<pre><code>-- v_dashboard : KPIs globaux en une seule requête
SELECT
  (SELECT COUNT(*) FROM clients) AS nb_clients,
  (SELECT COALESCE(SUM(montant_ttc),0) FROM factures) AS total_facture,
  (SELECT COALESCE(SUM(montant),0) FROM paiements) AS total_encaisse,
  ...

-- v_finance_projets : agrégats par projet
SELECT p.id, p.titre, c.nom AS client_nom,
  COALESCE(SUM(DISTINCT f.montant_ttc),0) AS total_facture,
  COALESCE(SUM(pa.montant),0) AS total_encaisse,
  COALESCE(SUM(DISTINCT d.montant),0) AS total_depenses,
  ...
FROM projets p ... GROUP BY p.id</code></pre>

<h3>Mise à jour automatique du statut des factures</h3>
<p>Après chaque enregistrement ou suppression de paiement, la fonction <code>updateStatutFacture()</code> recalcule automatiquement le statut de la facture : <em>envoyée → partiellement payée → payée</em> selon le total des paiements enregistrés vs le montant TTC.</p>

<h2>4. Sécurité</h2>

<div class="grid">
  <div class="box">
    <h4>Prévention Injection SQL</h4>
    <ul>
      <li>100% requêtes préparées PDO</li>
      <li>Paramètres bindés (<code>execute([...])</code>)</li>
      <li>Pas de concaténation de variables utilisateur en SQL</li>
    </ul>
  </div>
  <div class="box">
    <h4>Prévention XSS</h4>
    <ul>
      <li>Fonction <code>h()</code> = <code>htmlspecialchars()</code></li>
      <li>Utilisée sur toute sortie HTML</li>
      <li>Encodage UTF-8 forcé</li>
    </ul>
  </div>
  <div class="box">
    <h4>Validation serveur</h4>
    <ul>
      <li>Champs obligatoires vérifiés en PHP</li>
      <li>Cast numérique explicite (<code>(int)</code>, <code>(float)</code>)</li>
      <li>ENUM MySQL pour les valeurs contraintes</li>
    </ul>
  </div>
  <div class="box">
    <h4>Intégrité données</h4>
    <ul>
      <li>Clés étrangères avec CASCADE</li>
      <li>UNIQUE sur email client et numéro facture</li>
      <li>Confirmations JS avant suppression</li>
    </ul>
  </div>
</div>

<h2>5. Fonctionnalités implémentées</h2>

<table>
  <thead><tr><th>Fonctionnalité</th><th>Statut</th><th>Notes</th></tr></thead>
  <tbody>
    <tr><td>CRUD Clients</td><td>✅ Complet</td><td>+ recherche, vue détail avec projets</td></tr>
    <tr><td>CRUD Projets</td><td>✅ Complet</td><td>+ filtre statut, avancement tâches</td></tr>
    <tr><td>CRUD Tâches</td><td>✅ Complet</td><td>+ changement statut rapide, détection retard</td></tr>
    <tr><td>Création Factures</td><td>✅ Complet</td><td>+ calcul TTC auto, numéro auto</td></tr>
    <tr><td>Enregistrement Paiements</td><td>✅ Complet</td><td>+ mise à jour statut facture automatique</td></tr>
    <tr><td>Enregistrement Dépenses</td><td>✅ Complet</td><td>+ catégorisation, lien projet optionnel</td></tr>
    <tr><td>Suivi financier</td><td>✅ Complet</td><td>KPIs, évolution mensuelle, par projet, top clients</td></tr>
    <tr><td>Dashboard</td><td>✅ Complet</td><td>Projets actifs, tâches urgentes, factures en attente</td></tr>
  </tbody>
</table>

<h2>6. Difficultés rencontrées</h2>

<h3>Calcul du statut des factures</h3>
<p>Le statut d'une facture (<em>brouillon / envoyée / partiellement payée / payée</em>) dépend des paiements enregistrés. La difficulté était de maintenir la cohérence : chaque opération sur les paiements devait déclencher une réévaluation. Solution : fonction <code>updateStatutFacture()</code> appelée systématiquement après INSERT ou DELETE de paiement.</p>

<h3>Requêtes agrégatives avec LEFT JOIN multiples</h3>
<p>Le calcul simultané de plusieurs agrégats (total factures, total paiements, total dépenses) via des <code>LEFT JOIN</code> sur des tables avec des cardinalités différentes générait des doublons. Solution : utilisation de <code>SUM(DISTINCT)</code> et encapsulation dans des vues SQL pour clarifier les requêtes.</p>

<h3>Architecture sans framework</h3>
<p>Sans framework MVC, la gestion du routage et la réutilisation de code nécessitaient une discipline rigoureuse. La solution adoptée (paramètre <code>action</code> en GET, pattern switch dans chaque fichier) est simple mais efficace pour la taille du projet.</p>

<h2>7. Perspectives d'amélioration</h2>

<div class="grid">
  <div class="box">
    <h4>Court terme</h4>
    <ul>
      <li>Authentification multi-utilisateurs avec rôles</li>
      <li>Export PDF des factures (TCPDF / DomPDF)</li>
      <li>Notifications d'échéances par email (PHPMailer)</li>
      <li>Upload de justificatifs de dépenses</li>
      <li>Pagination des listes longues</li>
    </ul>
  </div>
  <div class="box">
    <h4>Moyen terme</h4>
    <ul>
      <li>API REST + frontend React/Vue.js</li>
      <li>Gestion des devis (avant facturation)</li>
      <li>Module de temps passé (timetracking)</li>
      <li>Imports/exports CSV Excel</li>
      <li>Portail client (accès limité)</li>
    </ul>
  </div>
  <div class="box">
    <h4>Long terme</h4>
    <ul>
      <li>Application mobile (React Native / PWA)</li>
      <li>Intégration comptable (sage, quickbooks)</li>
      <li>IA : estimation automatique des budgets</li>
      <li>Workflow d'approbation de factures</li>
      <li>Multi-devises et multi-TVA</li>
    </ul>
  </div>
  <div class="box">
    <h4>Infrastructure</h4>
    <ul>
      <li>Containerisation Docker</li>
      <li>CI/CD (GitHub Actions)</li>
      <li>Monitoring et logs applicatifs</li>
      <li>Backup automatique base de données</li>
    </ul>
  </div>
</div>

<div class="note">
  <strong>Note d'installation :</strong> Pour déployer l'application, importez <code>database.sql</code> dans MySQL, configurez les paramètres de connexion dans <code>includes/db.php</code> (DB_HOST, DB_USER, DB_PASS), puis placez les fichiers dans le répertoire web de votre serveur Apache/Nginx (XAMPP, WAMP ou serveur Linux). L'application est immédiatement opérationnelle avec les données de test incluses.
</div>

<h2>Conclusion</h2>

<p>Ce Mini ERP couvre l'ensemble des besoins opérationnels et financiers identifiés pour Nextmux. La stack PHP/MySQL choisie garantit simplicité de déploiement et maintenabilité. L'architecture, bien que volontairement sobre, pose des bases solides pour des évolutions futures vers une API REST ou une application mobile.</p>

<p>Le projet démontre qu'un outil de gestion fonctionnel et professionnel peut être construit avec des technologies fondamentales, sans dépendances lourdes, tout en respectant les bonnes pratiques de sécurité (requêtes préparées, échappement XSS, intégrité référentielle).</p>

<footer>
  Nextmux Mini ERP · Rapport technique v1.0 · Workshop Full-Stack PHP/MySQL
</footer>

</body>
</html>
